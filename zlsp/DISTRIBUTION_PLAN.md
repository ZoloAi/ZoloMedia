# Distribution Plan: Multi-Platform Deployment Strategy

**Purpose:** Document the comprehensive distribution strategy for zlsp across editors and operating systems while maintaining single source of truth (SSOT) architecture.

**Last Updated:** 2026-01-15  
**Status:** Phase 1 (Editor Extensions) - âš ï¸ In Progress (.vsix built, marketplace pending)

---

## Table of Contents

1. [Architecture Overview](#architecture-overview)
2. [Phase 1: Editor Extensions (.vsix)](#phase-1-editor-extensions-vsix)
3. [Phase 2: OS-Level File Icons](#phase-2-os-level-file-icons)
4. [Build Pipeline](#build-pipeline)
5. [Distribution Channels](#distribution-channels)
6. [Maintenance & Updates](#maintenance--updates)

---

## Architecture Overview

### Single Source of Truth (SSOT) Principle

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   themes/zolo_default.yaml      â”‚
                    â”‚   (CANONICAL COLOR SOURCE)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Theme Generation System       â”‚
                    â”‚   (bindings/python/generator)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚                          â”‚
        â–¼                          â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vim Colors   â”‚        â”‚  VS Code .vsix   â”‚      â”‚ Cursor Extensionâ”‚
â”‚  (runtime)    â”‚        â”‚  (build artifact)â”‚      â”‚  (build artifact)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Contains semantic-colors.json    â”‚
                    â”‚ (pre-generated from YAML)        â”‚
                    â”‚ Source documented in JSON        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Principle

**The .vsix is a COMPILATION artifact, not a second source of truth.**

Just like:
- `source.c` â†’ `binary` (compilation)
- `TypeScript` â†’ `JavaScript` (transpilation)
- `zolo_default.yaml` â†’ `.vsix` (theme compilation)

---

## Phase 1: Editor Extensions (.vsix)

### 1.1: VS Code Extension (.vsix Package)

**Status:** âš ï¸ Built - Not Yet Published (v1.0.2)

#### What is .vsix?

A `.vsix` file is a ZIP archive containing a complete VS Code extension:

```
zolo-lsp-1.0.0.vsix (ZIP archive)
â”œâ”€â”€ extension/
â”‚   â”œâ”€â”€ package.json                    # Extension manifest
â”‚   â”œâ”€â”€ out/extension.js                # LSP client
â”‚   â”œâ”€â”€ syntaxes/zolo.tmLanguage.json   # TextMate grammar
â”‚   â”œâ”€â”€ language-configuration.json     # Language settings
â”‚   â”œâ”€â”€ icons/zolo_filetype.png         # File type icon (IN-EDITOR)
â”‚   â”œâ”€â”€ themes/semantic-colors.json     # Pre-generated colors
â”‚   â””â”€â”€ README.md                       # User docs
â””â”€â”€ [Content_Types].xml                 # Package metadata
```

#### SSOT Compliance

**Generated Files (from `zolo_default.yaml`):**
- âœ… `themes/semantic-colors.json` - Auto-generated at build time
- âœ… `syntaxes/zolo.tmLanguage.json` - Generated from theme
- âœ… `package.json` (semantic token types) - Generated from theme

**Static Files:**
- âœ… `icons/zolo_filetype.png` - Design asset (visual, not code)
- âœ… `extension.js` - Template with injection points
- âœ… `language-configuration.json` - Language semantics (not colors)

**Verification:**
```json
// themes/semantic-colors.json includes source documentation
{
  "source": "themes/zolo_default.yaml",
  "generated": "Auto-generated by zlsp theme system",
  "generator_version": "1.0.0",
  "build_timestamp": "2026-01-15T08:00:00Z",
  "rules": {
    "zmetaKey": { "foreground": "#87d787" },
    // ... 40 token types
  }
}
```

#### Build Process

**Current Implementation:**
```bash
# Generate marketplace package
python3 editors/vscode/install.py --marketplace

# Output: editors/vscode/marketplace-package/
# Contains all files ready for packaging
```

**âœ… Completed Steps:**

1. âœ… **Installed vsce tool** - Used `npx @vscode/vsce` (no global install needed)

2. âœ… **Added file icon to package** - Icon integrated in v1.0.1

3. âœ… **Built .vsix** - v1.0.2 published to marketplace

4. âœ… **Tested locally** - Verified activation, colors, hover, completion

5. âœ… **Verified SSOT** - Colors match Vim exactly, source documented

**Build Info:**
- âœ… **Package built:** `zolo-lsp-1.0.2.vsix` (1.9 MB)
- âœ… **Location:** `editors/vscode/marketplace-package/`
- âœ… **Publisher ID:** ZoloMedia
- âœ… **Extension ID:** ZoloMedia.zolo-lsp
- âŒ **Marketplace status:** Not published yet

**TODO - VS Code Marketplace Publishing:**
- [ ] Create Microsoft publisher account
- [ ] Publish to VS Code Marketplace
- [ ] Test installation from marketplace

#### Icon Integration (IN-EDITOR ONLY)

**Scope:** File icons in VS Code sidebar, tabs, quick open

**Implementation:**

```python
# In editors/vscode/install.py, update generate_package_json():

"contributes": {
    "languages": [
        {
            "id": "zolo",
            "aliases": ["Zolo", "zolo"],
            "extensions": [".zolo"],
            "configuration": "./language-configuration.json",
            "icon": {
                "light": "./icons/zolo_filetype.png",
                "dark": "./icons/zolo_filetype.png"
            }
        }
    ],
    # ...
}

# And in install_extension_files(), copy the icon:
icon_src = Path(__file__).parent.parent.parent / 'assets' / 'zolo_filetype.png'
icon_dest = base_dir / 'icons' / 'zolo_filetype.png'
icon_dest.parent.mkdir(exist_ok=True)
shutil.copy2(icon_src, icon_dest)
```

**Result:** `.zolo` files show custom icon **inside VS Code only**

---

### 1.2: Cursor Extension (Open VSX Marketplace)

**Status:** âœ… **PUBLISHED** (v1.0.3 - Jan 15, 2026)  
**Publisher:** `ZoloAi` (matches Open VSX account)  
**URL:** https://open-vsx.org/extension/ZoloAi/zolo-lsp  
**Note:** Cursor uses Open VSX registry, NOT Microsoft's VS Code Marketplace

#### Cursor's Marketplace

Cursor uses **Open VSX** (https://open-vsx.org) - an open-source alternative:
- âœ… Open VSX is Cursor's extension source (launched Sept 11, 2023)
- âœ… Same `.vsix` file works for both VS Code and Cursor
- âœ… Eclipse Foundation manages Open VSX (free, open source)
- âœ… **Published as `ZoloAi.zolo-lsp` v1.0.3** (Jan 15, 2026)

**âœ… Open VSX Publishing Status (COMPLETED):**
- [x] Eclipse Foundation account created (Jan 15, 2026)
- [x] Signed Eclipse Contributor Agreement (ECA)
- [x] Created `ZoloAi` namespace on Open VSX
- [x] Updated publisher: `"ZoloMedia"` â†’ `"ZoloAi"` (namespace match)
- [x] Bumped version: `1.0.2` â†’ `1.0.3`
- [x] Published `zolo-lsp-1.0.3.vsix` to Open VSX
- [ ] Verify at: https://open-vsx.org/extension/ZoloAi/zolo-lsp (after v1.0.3 republish)
- [ ] Test searchability in Cursor Extensions panel

**Current Workaround:**
Users can manually install via "Install from VSIX..." in Cursor:
- File: `editors/vscode/marketplace-package/zolo-lsp-1.0.2.vsix`
- Full functionality, but no auto-updates

#### Implementation Method

Cursor uses **local extension registration** instead of .vsix:

```
~/.cursor/extensions/zolo-lsp-1.0.0/
â”œâ”€â”€ package.json
â”œâ”€â”€ out/extension.js
â”œâ”€â”€ syntaxes/zolo.tmLanguage.json
â”œâ”€â”€ language-configuration.json
â””â”€â”€ icons/zolo_filetype.png

~/.config/Cursor/User/extensions.json
â””â”€â”€ Registry entry with UUID
```

#### SSOT Compliance

Same as VS Code - generates from `zolo_default.yaml`:
- âœ… Colors injected globally (not theme-scoped)
- âœ… Cleanup logic for old installations
- âœ… Full feature parity with VS Code

#### Icon Integration

Same icon system as VS Code (when implemented):
- File icons in Cursor sidebar
- Tab icons
- Quick open (Cmd+P)

---

### 1.3: Vim Integration

**Status:** âœ… Complete - Production Ready

#### Implementation Method

Direct highlighting via Vim syntax system:
```vim
" Colors loaded from zolo_default.yaml at install time
highlight ZoloZmetaKey guifg=#87d787
highlight ZoloUIElementKey guifg=#ff5f00
" ... 40 token types
```

#### SSOT Compliance

âœ… **Master Reference**: Vim is the reference implementation for color accuracy

All other editors (VS Code, Cursor, marketplace) are tested against Vim output.

---

## Phase 2: OS-Level File Icons

**Status:** ğŸš§ **IN PROGRESS** (macOS + Linux)  
**Last Updated:** 2026-01-15  
**Audit Document:** [`PHASE_2.1_AUDIT.md`](./PHASE_2.1_AUDIT.md)

**Implementation Strategy:** Phased rollout with cost optimization

**Platforms:**
- âœ… **macOS:** Implementing (Developer account already owned - $0 marginal cost)
- âœ… **Linux:** Implementing (Free, open source)
- â¸ï¸ **Windows:** Deferred (Requires $100-400/year code signing cert)

**Revised Cost Analysis:**
- macOS: $0/year (existing Apple Developer membership)
- Linux: $0/year (no code signing required)
- Windows: Deferred until demand justifies $100-400/year investment

**Key Decision Factors:**
- âœ… Leverage existing Apple Developer account (sunk cost)
- âœ… Linux implementation is free and aligns with open source community
- âš ï¸ Windows code signing cost deferred until user demand materializes
- âœ… Scaffold Windows support for future implementation

**See detailed audit:** [`PHASE_2.1_AUDIT.md`](./PHASE_2.1_AUDIT.md) (18 pages, comprehensive analysis)

---

### Implementation Summary

**Timeline:** 7 days total
- macOS: 4 days (leveraging existing Apple Developer account)
- Linux: 3 days (Debian + Flatpak)
- Windows: Scaffolding only (~4 hours)

**Cost:**
- Year 1: $0 (macOS uses existing account, Linux is free)
- Ongoing: $0/year (until Windows implementation)
- Windows future: $100-400/year (when demand justifies)

**Deliverables:**
- âœ… `ZoloFileType-1.0.0.dmg` (macOS)
- âœ… `zolo-filetype_1.0.0_all.deb` (Debian/Ubuntu)
- âœ… `zolo-filetype.flatpak` (Universal Linux)
- âœ… `scripts/windows/*` (Windows scaffolding for future)

**Success Metrics:**
- Downloads: >50 per platform in first 3 months
- User feedback: Positive mentions in issues/discussions
- Support burden: <2 hours/month

**Windows Activation Criteria:**
- User requests: >50 explicit requests for Windows support
- OR Market share: Windows users >30% of total
- OR Funding: Sponsorship covers $400/year certificate cost

---

### 2.1: Overview (Reference Only)

**Scope:** File icons in **Finder (macOS)**, **Explorer (Windows)**, and **File Managers (Linux)**

**Distinction:** This is **completely separate** from editor integration:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OS Level (Finder/Explorer)                                 â”‚
â”‚  Requires: Native app, registry, or system packages        â”‚
â”‚  Icon Format: .icns (macOS), .ico (Windows), .png (Linux) â”‚
â”‚  Permissions: Admin/root access usually required           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Editor Level (VS Code/Cursor)                              â”‚
â”‚  Requires: Extension package only                          â”‚
â”‚  Icon Format: .png                                         â”‚
â”‚  Permissions: User-level only                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Important:** These are **two separate distribution channels** that don't interact.

---

### 2.2: macOS (Finder) Implementation

**Status:** ğŸš§ **IMPLEMENTING**  
**Cost:** $0 (using existing Apple Developer account)  
**Timeline:** ~4 days

#### Requirements

1. **Icon Format:** Convert PNG â†’ `.icns`
2. **Registration:** Native macOS app or helper utility
3. **Distribution:** `.dmg` installer or App Store

#### Implementation Strategy

**Option A: Simple "Opener" App**

Create a minimal macOS app that:
- Registers `.zolo` file type
- Provides custom icon
- Opens files in default text editor (VS Code/Cursor/Vim)

**App Structure:**
```
ZoloFileType.app/
â”œâ”€â”€ Contents/
â”‚   â”œâ”€â”€ Info.plist              # File type registration
â”‚   â”œâ”€â”€ Resources/
â”‚   â”‚   â””â”€â”€ zolo_filetype.icns  # macOS icon format
â”‚   â””â”€â”€ MacOS/
â”‚       â””â”€â”€ ZoloFileType        # Simple launcher script
```

**Info.plist Configuration:**
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" 
          "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>CFBundleIdentifier</key>
    <string>media.zolo.filetype</string>
    
    <key>CFBundleName</key>
    <string>Zolo File Type</string>
    
    <key>CFBundleVersion</key>
    <string>1.0.0</string>
    
    <key>CFBundleDocumentTypes</key>
    <array>
        <dict>
            <key>CFBundleTypeExtensions</key>
            <array>
                <string>zolo</string>
            </array>
            <key>CFBundleTypeIconFile</key>
            <string>zolo_filetype.icns</string>
            <key>CFBundleTypeName</key>
            <string>Zolo Configuration File</string>
            <key>CFBundleTypeRole</key>
            <string>Editor</string>
            <key>LSHandlerRank</key>
            <string>Default</string>
        </dict>
    </array>
    
    <key>LSMinimumSystemVersion</key>
    <string>10.13</string>
</dict>
</plist>
```

**Icon Conversion:**
```bash
# Convert PNG to ICNS (requires macOS)
mkdir zolo_filetype.iconset
sips -z 16 16     assets/zolo_filetype.png --out zolo_filetype.iconset/icon_16x16.png
sips -z 32 32     assets/zolo_filetype.png --out zolo_filetype.iconset/icon_16x16@2x.png
sips -z 32 32     assets/zolo_filetype.png --out zolo_filetype.iconset/icon_32x32.png
sips -z 64 64     assets/zolo_filetype.png --out zolo_filetype.iconset/icon_32x32@2x.png
sips -z 128 128   assets/zolo_filetype.png --out zolo_filetype.iconset/icon_128x128.png
sips -z 256 256   assets/zolo_filetype.png --out zolo_filetype.iconset/icon_128x128@2x.png
sips -z 256 256   assets/zolo_filetype.png --out zolo_filetype.iconset/icon_256x256.png
sips -z 512 512   assets/zolo_filetype.png --out zolo_filetype.iconset/icon_256x256@2x.png
sips -z 512 512   assets/zolo_filetype.png --out zolo_filetype.iconset/icon_512x512.png
sips -z 1024 1024 assets/zolo_filetype.png --out zolo_filetype.iconset/icon_512x512@2x.png
iconutil -c icns zolo_filetype.iconset
# Creates: zolo_filetype.icns
```

**Build Script:**
```bash
#!/bin/bash
# build-macos-filetype.sh

# Create app bundle structure
mkdir -p ZoloFileType.app/Contents/{MacOS,Resources}

# Copy icon
cp zolo_filetype.icns ZoloFileType.app/Contents/Resources/

# Copy Info.plist
cp Info.plist ZoloFileType.app/Contents/

# Create simple opener script
cat > ZoloFileType.app/Contents/MacOS/ZoloFileType << 'EOF'
#!/bin/bash
# Open .zolo files with default text editor
open -t "$@"
EOF

chmod +x ZoloFileType.app/Contents/MacOS/ZoloFileType

# Sign the app (requires Developer ID)
# codesign --force --deep --sign "Developer ID Application: Your Name" ZoloFileType.app

# Create DMG for distribution
hdiutil create -volname "Zolo File Type" -srcfolder ZoloFileType.app -ov -format UDZO ZoloFileType-1.0.0.dmg
```

**Distribution:**
- Upload `.dmg` to GitHub Releases
- Users drag app to `/Applications`
- Right-click any `.zolo` file â†’ Get Info â†’ Open with: ZoloFileType.app â†’ Change All

---

### 2.3: Windows (Explorer) Implementation

**Status:** â¸ï¸ **DEFERRED** (Scaffold Only)  
**Cost:** $100-400/year (code signing certificate required)  
**Blocker:** Code signing cost not justified until user demand materializes

**Scaffolding Approach:**
- âœ… Create icon conversion scripts (PNG â†’ .ico)
- âœ… Write registry templates
- âœ… Document PowerShell installer scripts
- âŒ Do NOT purchase code signing certificate yet
- âŒ Do NOT distribute unsigned installers (Windows Defender flags as malware)

**Revisit when:** >50 Windows users request feature OR sponsorship covers certificate cost

#### Requirements (For Future Implementation)

1. **Icon Format:** Convert PNG â†’ `.ico`
2. **Registration:** Windows Registry entries
3. **Distribution:** `.exe` installer or `.reg` file

#### Implementation Strategy

**Option A: Registry Installer**

**Icon Conversion:**
```bash
# Convert PNG to ICO (requires ImageMagick)
convert assets/zolo_filetype.png -define icon:auto-resize=256,128,64,48,32,16 zolo_filetype.ico
```

**Registry File (zolo-filetype.reg):**
```registry
Windows Registry Editor Version 5.00

; Register .zolo file extension
[HKEY_CLASSES_ROOT\.zolo]
@="ZoloMedia.ZoloFile"
"Content Type"="text/plain"

; Define file type
[HKEY_CLASSES_ROOT\ZoloMedia.ZoloFile]
@="Zolo Configuration File"

; Set custom icon
[HKEY_CLASSES_ROOT\ZoloMedia.ZoloFile\DefaultIcon]
@="%PROGRAMFILES%\\ZoloMedia\\icons\\zolo_filetype.ico,0"

; Open with default text editor
[HKEY_CLASSES_ROOT\ZoloMedia.ZoloFile\shell\open\command]
@="notepad.exe \"%1\""

; Context menu - Open with VS Code (if installed)
[HKEY_CLASSES_ROOT\ZoloMedia.ZoloFile\shell\VSCode]
@="Open with VS Code"
[HKEY_CLASSES_ROOT\ZoloMedia.ZoloFile\shell\VSCode\command]
@="\"C:\\Program Files\\Microsoft VS Code\\Code.exe\" \"%1\""
```

**Installer Script (PowerShell):**
```powershell
# install-zolo-filetype.ps1
# Requires Administrator privileges

$ErrorActionPreference = "Stop"

# Create icons directory
$iconDir = "$env:ProgramFiles\ZoloMedia\icons"
New-Item -ItemType Directory -Force -Path $iconDir

# Copy icon
Copy-Item "zolo_filetype.ico" -Destination "$iconDir\zolo_filetype.ico"

# Import registry settings
reg import zolo-filetype.reg

# Refresh icon cache
ie4uinit.exe -show

Write-Host "âœ“ Zolo file type registered successfully!" -ForegroundColor Green
Write-Host "  Right-click any .zolo file to see 'Open with VS Code' option"
```

**Uninstaller:**
```powershell
# uninstall-zolo-filetype.ps1

reg delete "HKEY_CLASSES_ROOT\.zolo" /f
reg delete "HKEY_CLASSES_ROOT\ZoloMedia.ZoloFile" /f
Remove-Item -Recurse -Force "$env:ProgramFiles\ZoloMedia"

Write-Host "âœ“ Zolo file type unregistered" -ForegroundColor Green
```

**Distribution:**
- Package as `.zip` with icon + registry file + PowerShell scripts
- Or create proper `.msi` installer using WiX Toolset
- Distribute via GitHub Releases

#### Windows Scaffolding Strategy (Current Approach)

**What we're building NOW:**
- âœ… Icon conversion scripts (`scripts/windows/convert-icon.sh`)
- âœ… Registry templates (`scripts/windows/zolo-filetype.reg`)
- âœ… PowerShell installer templates (`scripts/windows/install-zolo-filetype.ps1`)
- âœ… Uninstaller templates (`scripts/windows/uninstall-zolo-filetype.ps1`)
- âœ… Documentation (`scripts/windows/README.md`)

**What we're NOT doing YET:**
- âŒ Purchasing code signing certificate ($100-400/year)
- âŒ Building signed installers
- âŒ Distributing to Windows users
- âŒ Testing on Windows (can defer until implementation)

**Future Implementation (When Triggered):**
1. Purchase Authenticode certificate from DigiCert/Sectigo
2. Sign all executables and installers
3. Test on Windows 10/11
4. Distribute via GitHub Releases
5. Update documentation for Windows users

**Trigger Conditions:**
- >50 Windows users explicitly request feature
- OR sponsorship covers certificate cost ($100-400/year)
- OR Windows market share of zlsp users exceeds 30%

**Benefit of Scaffolding:**
- âœ… Reduces future implementation time (2 days â†’ 4 hours)
- âœ… No wasted effort (scripts reusable when ready)
- âœ… Documents intent for contributors
- âœ… Easy to activate when trigger conditions met

---

### 2.4: Linux (File Managers) Implementation

**Status:** ğŸš§ **IMPLEMENTING**  
**Cost:** $0 (no code signing required)  
**Timeline:** ~3 days  
**Focus:** Debian/Ubuntu (`.deb`) + Flatpak (covers ~80% of desktop Linux users)

#### Requirements

1. **Icon Format:** `.png` (standard sizes: 16x16, 32x32, 48x48, 256x256)
2. **Registration:** Desktop entry + MIME type
3. **Distribution:** Distro-specific packages (`.deb`, `.rpm`, etc.)

#### Implementation Strategy

**MIME Type Definition:**

Create `zolo.xml`:
```xml
<?xml version="1.0" encoding="UTF-8"?>
<mime-info xmlns="http://www.freedesktop.org/standards/shared-mime-info">
    <mime-type type="text/x-zolo">
        <comment>Zolo Configuration File</comment>
        <comment xml:lang="en">Zolo Configuration File</comment>
        <glob pattern="*.zolo"/>
        <sub-class-of type="text/plain"/>
        <icon name="text-x-zolo"/>
    </mime-type>
</mime-info>
```

**Desktop Entry:**

Create `zolo-filetype.desktop`:
```desktop
[Desktop Entry]
Type=Application
Name=Zolo File
Comment=Zolo Configuration File
MimeType=text/x-zolo;
Icon=text-x-zolo
NoDisplay=true
Exec=xdg-open %f
Categories=TextEditor;Utility;
```

**Installation Script:**
```bash
#!/bin/bash
# install-zolo-filetype-linux.sh

set -e

PREFIX="${PREFIX:-/usr/local}"
ICON_DIR="$PREFIX/share/icons/hicolor"
MIME_DIR="$PREFIX/share/mime/packages"
APP_DIR="$PREFIX/share/applications"

# Install icon at multiple sizes
for size in 16 32 48 256; do
    DEST="$ICON_DIR/${size}x${size}/mimetypes"
    mkdir -p "$DEST"
    convert assets/zolo_filetype.png -resize ${size}x${size} "$DEST/text-x-zolo.png"
done

# Install MIME type definition
mkdir -p "$MIME_DIR"
cp zolo.xml "$MIME_DIR/zolo.xml"

# Install desktop entry
mkdir -p "$APP_DIR"
cp zolo-filetype.desktop "$APP_DIR/zolo-filetype.desktop"

# Update databases
update-mime-database "$PREFIX/share/mime" 2>/dev/null || true
update-desktop-database "$APP_DIR" 2>/dev/null || true
gtk-update-icon-cache "$ICON_DIR" 2>/dev/null || true

echo "âœ“ Zolo file type registered for Linux"
echo "  Restart your file manager to see changes"
```

**Debian Package Structure:**

```
zolo-filetype_1.0.0_all.deb
â””â”€â”€ debian/
    â”œâ”€â”€ control
    â”œâ”€â”€ install
    â”œâ”€â”€ postinst
    â””â”€â”€ prerm
```

**debian/control:**
```
Package: zolo-filetype
Version: 1.0.0
Architecture: all
Maintainer: Zolo Media <support@zolomedia.com>
Description: File type registration for .zolo files
 Provides custom icons and MIME type registration for Zolo
 configuration files in Linux desktop environments.
Depends: shared-mime-info, desktop-file-utils
```

**Build .deb:**
```bash
dpkg-deb --build zolo-filetype_1.0.0_all
```

---

## Build Pipeline

### Automated Build Process

**Goal:** Single command to build all distribution artifacts

```bash
# Build everything (Phase 2 partial)
make dist

# Or individually:
make dist-vscode      # Creates .vsix
make dist-cursor      # Creates extension package
make dist-macos       # Creates .dmg (implementing)
make dist-linux       # Creates .deb, Flatpak (implementing)
make dist-windows     # Scaffolded only (not building yet)
```

**Makefile Structure:**

```makefile
.PHONY: dist dist-vscode dist-cursor dist-macos dist-windows dist-linux

VERSION := $(shell python3 -c "from zlsp.core.version import __version__; print(__version__)")

# Phase 2: Build macOS + Linux only (Windows deferred)
dist: dist-vscode dist-cursor dist-macos dist-linux

dist-vscode:
	@echo "Building VS Code .vsix..."
	python3 editors/vscode/install.py --marketplace
	cd editors/vscode/marketplace-package && vsce package
	mv editors/vscode/marketplace-package/*.vsix dist/

dist-cursor:
	@echo "Cursor uses direct installation (zlsp-cursor-install)"
	@echo "No separate package needed"

dist-macos:
	@echo "Building macOS file type app..."
	./scripts/build-macos-filetype.sh
	mv ZoloFileType-$(VERSION).dmg dist/

dist-windows:
	@echo "Windows support deferred (code signing cost)"
	@echo "Scaffold scripts available in scripts/windows/ (not executed)"
	@echo "Run 'make scaffold-windows' to prepare files without signing"

scaffold-windows:
	@echo "Generating Windows scaffolding (unsigned, for reference)..."
	./scripts/scaffold-windows-filetype.sh
	@echo "NOTE: Do not distribute unsigned installers (SmartScreen blocks them)"

dist-linux:
	@echo "Building Linux packages..."
	./scripts/build-linux-packages.sh
	mv *.deb dist/
	mv *.flatpak dist/

clean:
	rm -rf dist/*
	rm -rf editors/vscode/marketplace-package
	rm -rf build/
```

---

## Marketplace Ecosystem Overview

### Understanding Extension Registries

There are **two separate extension registries** for VS Code-compatible editors:

| Registry | VS Code Marketplace | Open VSX |
|----------|-------------------|----------|
| **URL** | marketplace.visualstudio.com | open-vsx.org |
| **Owner** | Microsoft (proprietary) | Eclipse Foundation (open source) |
| **License** | Microsoft TOS | EPL 2.0 (open source) |
| **Used by** | VS Code (official only) | Cursor, VSCodium, Gitpod, Theia |
| **Extensions** | 40,000+ | 3,800+ |
| **Access** | Closed API | Open API |

**Why two registries?**
- Microsoft's VS Code Marketplace is **proprietary** - only official VS Code can use it
- Open source forks (Cursor, VSCodium) are **legally blocked** from accessing it
- Open VSX provides a **vendor-neutral alternative** for the open source community

**Publishing strategy:**
- Same `.vsix` file works on **both** registries
- Best practice: **Publish to both** for maximum reach
- No conflicts - they're completely independent ecosystems

---

## Distribution Channels

### 1. Direct Installation (Primary)

**Python Package (PyPI):**
```bash
pip install zlsp
zlsp-vscode-install    # VS Code
zlsp-cursor-install    # Cursor
```

**Advantages:**
- âœ… Always up-to-date with latest colors
- âœ… SSOT guaranteed (generates from YAML)
- âœ… Works immediately after pip install

---

### 2. VS Code Marketplace (Future - Not Published)

**Status:** âš ï¸ Built but not published

**When published, distribution will be:**
```bash
# One-time setup
vsce login ZoloMedia

# Publish
cd editors/vscode/marketplace-package
vsce publish
```

**User Installation (after publishing):**
- Search "Zolo LSP" in VS Code Extensions
- Click Install
- Extension prompts if `zolo-lsp` not found: "Run: pip install zlsp"

**Advantages:**
- âœ… Discoverability for VS Code users
- âœ… Auto-updates via VS Code
- âœ… One-click install from UI

**SSOT Compliance:**
- âœ… Marketplace .vsix is build artifact
- âœ… Generated from `zolo_default.yaml` at build time
- âœ… Source documented in bundled `semantic-colors.json`

**TODO:**
- [ ] Create Microsoft publisher account
- [ ] Publish v1.0.2 to VS Code Marketplace
- [ ] Update docs with marketplace URL

---

### 3. Open VSX Registry

**Status:** âœ… **PUBLISHED** (Jan 15, 2026)  
**Publisher:** `ZoloAi`  
**Extension:** `ZoloAi.zolo-lsp` v1.0.3  
**URL:** https://open-vsx.org/extension/ZoloAi/zolo-lsp

**When published, distribution will be:**
```bash
# Option A: CLI
cd editors/vscode/marketplace-package
npx ovsx publish zolo-lsp-1.0.2.vsix -p <token>

# Option B: Web UI (easier)
# Upload zolo-lsp-1.0.2.vsix at https://open-vsx.org
```

**User Installation (after publishing):**
- **Cursor users:** Search "Zolo LSP" in Extensions â†’ Install
- **VSCodium users:** Search "Zolo LSP" in Extensions â†’ Install
- **Gitpod users:** Pre-install via `.gitpod.yml`

**Advantages:**
- âœ… Discoverability for Cursor users (primary use case)
- âœ… Auto-updates for open source editor users
- âœ… One-click install from UI
- âœ… Open source ecosystem support

**Current Blocker:**
- âŒ Eclipse Foundation account creation failing (reported Jan 2026)
- âŒ Email validation errors (rejects valid email formats)
- âŒ Post-verification login failures
- ğŸ”— Issue tracked: https://gitlab.eclipse.org/eclipsefdn/helpdesk/-/issues/6449

**TODO (when unblocked):**
- [ ] Wait for Eclipse Foundation to fix account creation
- [ ] Create Eclipse Foundation account
- [ ] Sign Eclipse Contributor Agreement (ECA)
- [ ] Create `ZoloMedia` namespace
- [ ] Upload `zolo-lsp-1.0.2.vsix` via web UI
- [ ] Verify: https://open-vsx.org/extension/ZoloMedia/zolo-lsp
- [ ] Test in Cursor Extensions panel

**Workaround for Cursor users:**
Manual installation via "Install from VSIX..." in Cursor:
- File: `editors/vscode/marketplace-package/zolo-lsp-1.0.2.vsix`
- âš ï¸ No auto-updates with this method

---

### 4. OS File Type Packages (Phase 2 - Partial Implementation)

**macOS:** ğŸš§ Implementing
- Distribution: GitHub Releases `ZoloFileType-1.0.0.dmg`
- Installation: Download, drag to Applications, set default app
- Cost: $0 (using existing Apple Developer account)
- Timeline: 4 days
- Optional, not required for editing

**Linux:** ğŸš§ Implementing
- Distribution: GitHub Releases `.deb` + Flatpak
- Installation: `sudo apt install` or `flatpak install`
- Cost: $0 (no code signing)
- Timeline: 3 days
- Focus: Debian/Ubuntu + Flatpak (80% coverage)
- Optional, not required for editing

**Windows:** â¸ï¸ Deferred (Scaffolded)
- Scripts prepared: `scripts/windows/` directory
- Distribution: Blocked until code signing certificate purchased
- Cost when implemented: $100-400/year
- Revisit when: >50 Windows user requests
- Optional, not required for editing

**Marketing (After macOS + Linux Release):**
```
Want .zolo files to show custom icons in Finder/File Manager?
Download the OS integration package!

âœ… macOS: ZoloFileType-1.0.0.dmg
âœ… Linux: zolo-filetype_1.0.0_all.deb or Flatpak
â³ Windows: Coming when demand justifies code signing cost
```

---

## Maintenance & Updates

### Update Workflow

**When colors change in `zolo_default.yaml`:**

```bash
# 1. Update theme
vim themes/zolo_default.yaml

# 2. Test in Vim (reference implementation)
vim example.zolo
# Verify colors are correct

# 3. Rebuild VS Code .vsix
python3 editors/vscode/install.py --marketplace
cd editors/vscode/marketplace-package
vsce package
vsce publish  # Pushes to marketplace

# 4. Python package (pip users get new colors automatically)
git tag v1.0.1
git push --tags
# GitHub Actions builds and publishes to PyPI

# 5. Test marketplace version
code --install-extension zolo-lsp-1.0.1.vsix
# Verify colors match Vim

# 6. OS file type icons (rarely need updates)
# Only rebuild if icon design changes
```

### Version Synchronization

**Single Version Number:**
```python
# zlsp/core/version.py
__version__ = "1.0.1"
```

**Used by:**
- Python package (PyPI)
- VS Code extension (package.json)
- Cursor extension (package.json)
- macOS app (Info.plist)
- Windows installer (registry)
- Linux packages (control file)

**Update all at once:**
```bash
./scripts/bump-version.sh 1.0.1
# Updates version in all files
```

---

## Testing Strategy

### Pre-Release Checklist

#### SSOT Verification

```bash
# 1. Colors match across editors
./scripts/test-color-consistency.sh
# Compares Vim output (reference) vs VS Code vs Cursor

# 2. Semantic token snapshot tests
zlsp test --integration
# Verifies token output matches golden baselines

# 3. Extract and verify .vsix contents
unzip -p zolo-lsp-1.0.0.vsix extension/themes/semantic-colors.json
# Check "source": "themes/zolo_default.yaml"
# Check colors match theme
```

#### Functional Testing

```bash
# VS Code
code --install-extension zolo-lsp-1.0.0.vsix
# Open .zolo file
# Check: syntax highlighting, hover, completion, diagnostics

# Cursor
zlsp-cursor-install
# Reload Cursor
# Same checks

# macOS File Icons
open -a Finder .
# Check: .zolo files show custom icon

# Windows File Icons
explorer .
# Check: .zolo files show custom icon

# Linux File Icons
nautilus . &  # or your file manager
# Check: .zolo files show custom icon
```

---

## Security Considerations

### Code Signing

**macOS:**
```bash
codesign --force --deep --sign "Developer ID Application: Your Name" ZoloFileType.app
# Required for Gatekeeper (macOS 10.15+)
```

**Windows:**
```bash
signtool sign /f certificate.pfx /p password /t http://timestamp.digicert.com installer.exe
# Optional but recommended
```

### Sandboxing

**VS Code Extensions:**
- Run in VS Code extension host (sandboxed)
- No system-level access
- Can only modify VS Code settings

**OS File Type Apps:**
- macOS app sandbox (optional)
- Windows UAC elevation (for registry)
- Linux runs with user permissions

---

## Documentation

### User-Facing Docs

**README Updates:**
```markdown
## Installation

### Editor Support
- **VS Code**: `pip install zlsp && zlsp-vscode-install`
- **Cursor**: `pip install zlsp && zlsp-cursor-install`
- **Vim**: Included with pip install

### Custom File Icons (Optional)
Want .zolo files to show custom icons in Finder/Explorer?

- **macOS**: Download [ZoloFileType.dmg](link)
- **Windows**: Download [zolo-filetype-windows.zip](link)
- **Linux**: Download [zolo-filetype.deb](link) or [.rpm](link)

These are **optional** and only affect icons outside the editor.
```

### Developer Docs

**Building from Source:**
```markdown
# Build .vsix
make dist-vscode

# Build OS integrations
make dist-macos
make dist-windows
make dist-linux

# Build everything
make dist
```

---

## Rollout Plan

### Phase 1: Editor Extensions âš ï¸ In Progress
- [x] Vim integration (complete)
- [x] VS Code Python installer (complete)
- [x] Cursor Python installer (complete)
- [x] Add file icon to extensions
- [x] Build .vsix (v1.0.3)
- [x] Test .vsix locally
- [x] **Publish to Open VSX** âœ… (as `ZoloAi.zolo-lsp` v1.0.3)
- [ ] Publish to VS Code Marketplace (Microsoft publisher needed)

**Current Status:**
1. **Open VSX:** âœ… **PUBLISHED** (https://open-vsx.org/extension/ZoloAi/zolo-lsp)
2. **VS Code Marketplace:** â³ Pending (Microsoft publisher account not created yet)

**Timeline:** 
- Open VSX: âœ… Complete
- VS Code Marketplace: Pending user decision to create Microsoft publisher account

---

### Phase 2: OS File Icons ğŸš§ IN PROGRESS
- [x] Conducted detailed audit ([PHASE_2.1_AUDIT.md](./PHASE_2.1_AUDIT.md))
- [x] Cost-benefit analysis completed
- [x] **Decision:** Implement macOS + Linux, defer Windows
- [ ] **Phase 2.2:** Build macOS app + DMG (in progress)
  - [ ] Convert PNG to .icns (10 sizes)
  - [ ] Create app bundle structure
  - [ ] Configure Info.plist
  - [ ] Code sign with existing Developer ID
  - [ ] Notarize with Apple
  - [ ] Create DMG installer
  - [ ] Test on macOS 13-15
- [ ] **Phase 2.4:** Build Linux packages (in progress)
  - [ ] Generate multi-size PNGs (16, 32, 48, 256px)
  - [ ] Create MIME type definition (zolo.xml)
  - [ ] Create desktop entry
  - [ ] Build .deb package (Debian/Ubuntu)
  - [ ] Build Flatpak package
  - [ ] Test on Ubuntu 22.04, 24.04
- [ ] **Phase 2.3:** Windows installer (DEFERRED - scaffold only)
  - [ ] Create PNG â†’ .ico conversion scripts
  - [ ] Document registry structure
  - [ ] Write PowerShell installer templates
  - [ ] ~~Purchase code signing certificate~~ (deferred)
  - [ ] ~~Build signed installer~~ (deferred)

**Rationale for Phased Approach:**
- âœ… Leverage existing Apple Developer account ($0 cost)
- âœ… Linux is free and aligns with open source values
- âš ï¸ Windows code signing ($100-400/year) deferred until demand justifies
- âœ… Scaffold Windows for future implementation

**Timeline:** 
- macOS: 4 days
- Linux: 3 days  
- Windows: Deferred (revisit when >50 users request OR funding secured)

---

## Decision Points

### Should We Implement OS File Icons?

**Pros:**
- âœ… Professional polish
- âœ… Better user experience
- âœ… Brand visibility

**Cons:**
- âŒ Significant maintenance burden
- âŒ Multiple OS versions to support
- âŒ Code signing requirements ($$)
- âŒ Separate distribution channels
- âŒ Not required for functionality

**Industry Standard:**
- Most LSP projects (Rust, Go, TypeScript) **don't** provide OS icons
- Users are accustomed to generic text file icons
- Editor icons are sufficient

**Recommendation:** **Defer to Phase 2 (future)**
- Focus on getting marketplace extension perfect first
- Revisit OS icons if users request it

---

## Appendix

### A. Icon Formats Reference

| Platform | Format | Sizes Required | Tool |
|----------|--------|----------------|------|
| macOS | `.icns` | 16-1024px (10 sizes) | `iconutil` |
| Windows | `.ico` | 16-256px (6 sizes) | ImageMagick |
| Linux | `.png` | 16, 32, 48, 256px | `convert` |
| VS Code | `.png` | 256x256 recommended | N/A |

### B. Useful Commands

```bash
# Verify .vsix contents
unzip -l zolo-lsp-1.0.0.vsix

# Extract specific file from .vsix
unzip -p zolo-lsp-1.0.0.vsix extension/package.json | jq .

# Test extension locally
code --install-extension path/to/extension.vsix --force

# View VS Code extension logs
code --log trace

# Uninstall extension
code --uninstall-extension zolo-ai.zolo-lsp
```

### C. Resources

- [VS Code Extension API](https://code.visualstudio.com/api)
- [vsce Publishing Tool](https://github.com/microsoft/vscode-vsce)
- [macOS File Type Registration](https://developer.apple.com/documentation/uniformtypeidentifiers)
- [Windows File Associations](https://docs.microsoft.com/windows/win32/shell/fa-file-types)
- [Linux Desktop Entry Spec](https://specifications.freedesktop.org/desktop-entry-spec/)

---

**Next Steps:** See [REFACTORING_PLAN.md Phase 7.1.8](./REFACTORING_PLAN.md#718-future-enhancements) for immediate action items.
